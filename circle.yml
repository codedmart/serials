machine:
  environment:
    PATH: ${PATH}:/home/ubuntu/bin
    NODE_ENV: test
  services:
    - docker

dependencies:
  pre:
    - sudo apt-get -y -qq update; sudo apt-get -y -qq install wget unzip
    - wget http://flowtype.org/downloads/flow-linux64-latest.zip
    - unzip -o flow-linux64-latest.zip
    - mkdir /home/ubuntu/bin
    - mv ./flow/flow /home/ubuntu/bin
    - which flow
    - rm -rf ./flow

  override:
    - ls
    - docker info
    - bin/build

test:
  override:
    - sleep 10
    - echo "Running tests"
    # run extra tests here
    #- sudo lxc-attach -n "$(docker inspect --format '{{.Id}}' seanhess/serials)" -- bash -c flow
    # I'd like to be able to run flow without

deployment:
  hub:
    branch: master
    commands:
      - echo "EMAIL=$DOCKER_EMAIL USER=$DOCKER_USER PASS=$DOCKER_PASS"
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - docker push seanhess/serials
      - bin/remote


